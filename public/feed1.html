<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./public/css/reset.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.12/css/all.css" integrity="sha384-G0fIWCsCzJIMAVNQPfjH08cyYaUtMwjJwqiRKxxE/rx96Uroj1BtIQ6MLJuheaO9" crossorigin="anonymous">
    <link rel="stylesheet" href="./css/feed.css">
    <title>UNI Chat Feed | 1</title>
</head>

<body>
    <div class="row">
        <div class="col s12">
            <button id="logoutBtn">Logout</button>
        </div>

        <!-- Links on left -->
        <div class="row">
            <div id="profile" class="col s2">
                <a href="devpage.html">
                    <img id="feedLogo" src="./images/unichatlogo-sml.png" alt="UNI Chat logo sm">
                </a>
                

                <h3>Dorm 1</h3>
                <div>
                    <a id="links" href="#">Profile</a>
                </div>
                <div>
                    <a id="links" href="#">Current</a>
                </div>
                <div>
                    <a id="links" href="#">Top</a>
                </div>
            </center>
        </div>
        <!-- Input for Posting -->
        <div id="posts" class="col s7">
            <form id="postForm">
                <!-- <div class="row"> -->
                <div class="input-field col s12 z-depth-2">
                    <textarea id="textarea2" class="materialize-textarea" data-length="150"></textarea>
                    <label for="textarea2">Post Away</label>
                </div>
                <br>
                <button id='postSubmitBTN' class="btn waves-effect waves-light submitBtn" type="submit" name="action">Post
                    <i class="material-icons right"></i>
                </button>
                <!-- </div> -->
            </form>
            <div class="row" id='postTabs'>
                <div class="col s12">
                    <ul class="tabs">
                        <li class="tab col s6">
                            <a id='tabs' href="#newPosts">NEW</a>
                        </li>
                        <li class="tab col s6">
                            <a id='tabs' href="#hotPosts">TRENDING</a>
                        </li>
                    </ul>
                </div>
                <div id="newPosts" class="col s12"></div>
                <div id="hotPosts" class="col s12"></div>
            </div>
        </div>




        <!-- Announcements Column -->
        <div id="announcements" class="col s3">
            <!-- Admin Announcements div -->
            <div class="row admin">
                <div class="col s12 m12">
                    <div class="card-panel adminCard">
                 <h4>Admin <i class="fas fa-bullhorn"></i> Announcements</h4>
                        <div id="adminCard"></div>

                    </div>
                </div>
            </div>
            <!-- RA Announcements div -->
            <div class="row ra">
                <div class="col s12 m12">
                    <div class="card-panel raCard">
                        <h4 id="raHeader" class="anHeader">RA Announcements</h4>
                        <div id="raCard"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>

    <script src="https://apis.google.com/js/client.js?onload=init"></script>
    <script src="./js/feed1.js"></script>
    <script>

        $(document).ready(function () {
            $('.tabs').tabs();
        });

        $.get('/students1/posts').then(function (data, status) {
            console.log(data)
            // loops through data
            for (var key in data) {
                console.log(data[key].id)
                var postBody = data[key].body
                var postTime = data[key].createdAt
                var postId = data[key].id
                $('#newPosts').prepend(
                    "<div id='uPost'><h4>" + postBody + "</h4>" +
                    "<p>" + postTime + "</p></div>" +
                    // get comments and number of comments to display & upvotes/downvotes buttons
                    "<div id= 'commentLink'>COMMENTS</div><upvotes><button id='upvoteBtn' value='" + postId + "'>Upvote</button><button id='downvoteBtn' value='" + postId + "'>Downvote</button>"
                )
                // add downvote & upvote counts
                $('#upvoteBtn').on('click', function () {
                    var uVotes = 0;
                    var upvoteID = $(this).val()
                    console.log(upvoteID)
                    // $.post('/students2/posts', function (req, res) {
                    //     console.log(res)
                    // });


                    $.get('/students1/posts', function (data, status) {
                        for (var key in data) {
                            if (upvoteID == data[key].id) {
                                uVotes = data[key].upvotes + 1;
                                
                                // console.log('found a match at id #' + postId)

                                var postUpdate = {
                                    id: upvoteID,
                                    upvotes: uVotes
                                };

                                $.post('/students1/updateUp', postUpdate, function (data, status) {
                                })
                            }
                        }


                        // where id matches this id add one upvote
                        // limit 1 per user

                    })
                });


                $('#downvoteBtn').on('click', function () {
                    var dVotes = 0;
                    var downvoteID = $(this).val()

                    $.get('/students1/posts', function (data, status) {
                        for (var key in data) {
                            if (downvoteID == data[key].id) {
                                dVotes = data[key].downvotes + 1;
                                
                                // console.log('found a match at id #' + postId)

                                var postUpdate = {
                                    id: downvoteID,
                                    downvotes: dVotes
                                };

                                $.post('/students1/updateDown', postUpdate, function (data, status) {
    
                                })
                            }
                        }


                        // where id matches this id add one upvote
                        // limit 1 per user

                    })
                });
            }
        });


        // getting RA posts to post, how many?
        // $.get('/students2/ra/posts').then(function (data, status) {
        //     console.log(data);
        //     for (var key in data) {
        //         var RApost = data[key].body
        //     }
        // })


    </script>

</body>

</html>